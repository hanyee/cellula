<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>the-simple-way-form</title>

    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/base.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/font.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/function.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-table.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-title.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-button.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-form.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-tip.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-tab.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-list.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-xbox.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-box.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-message.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-icon.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-line.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-footer.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-notice.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-step.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-pop.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-column.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-repeater.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-paging.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-dialog.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/tpl/ui-grid.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/solutions/sl-input-file.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/solutions/sl-linear.css"/>
    <link type="text/css" media="screen" charset="utf-8" rel="stylesheet" href="stylearale/default.css"/>
    <style type="text/css">
        .section {
            margin: 20px 0 0;
        }
    </style>
</head>
<body>
<form class="ui-form fn-mt20" method="post" action="#">
    <div class="ui-form-item ui-form-item-success">
        <label class="ui-label"><span class="required">*</span>网点编号：</label>
        <input id="J_siteNo" name="siteNo" type="text" value="aaaaa" class="ui-input" />

        <div class="ui-form-explain fn-hide">提示信息</div>
    </div>
    <div class="ui-form-item ui-form-item-success">
        <label class="ui-label"><span class="required">*</span>批次号：</label>
        <input id="J_batchNo" name="batchNo" type="text" value="12445" class="ui-input" />

        <div class="ui-form-explain fn-hide">请填写批次号</div>
    </div>
    <div class="ui-form-item ui-form-item-cue">
        <label class="ui-label">创建时间：</label>
        <input id="J_beginDate" name="beginDate" type="text" class="ui-input ui-input-hover" value="2012-01-01" />
        <span class="ui-form-spliter">到</span>
        <input id="J_endDate" name="endDate" type="text" class="ui-input" value="2012-02-03" />

        <div class="ui-form-explain">起始日期, 格式为 yyyy-mm-dd</div>
    </div>

    <div class="ui-form-item ui-form-item-last">
        <span class="ui-button ui-button-mblue ui-button-mblue-next">
            <input type="submit" value="确定" class="ui-button-text">
            <span class="ui-button-icon"></span>
        </span>
    </div>

    <div class="ui-table fn-mt20 fn-hide">
        <table>
            <colgroup>
                <col width="200">
                <col width="200">
                <col width="200">
                <col>
            </colgroup>
            <thead>
            <tr>
                <th>
                    <a href="#" class="sort">序号</a>
                </th>
                <th>
                    <a href="#" class="sort">名称</a>
                </th>
                <th>
                    <a href="#" class="sort">简介</a>
                </th>
                <th>
                    <a href="#" class="sort">备注</a>
                </th>
            </tr>
            </thead>
            <!--
            <tbody>
            <tr>
                <td>90000</td>
                <td>兰坤</td>
                <td>111111111111111111</td>
                <td>江西体彩</td>
            </tr>
            <tr class="ui-table-spliter">
                <td>90000</td>
                <td>兰坤</td>
                <td>111111111111111111</td>
                <td>江西体彩</td>
            </tr>
            </tbody>
            -->
        </table>
    </div>
    <div class="ui-notice ui-notice-warn fn-mt20 fn-hide">
        <h3 class="ui-notice-title">没有查询到结果</h3>
        <p class="ui-notice-explain-other">
            没有查询到可显示的信息
        </p>
    </div>
    <div class="ui-notice ui-notice-error fn-mt20 fn-hide">
        <div class="ui-notice-cnt">
            <h3 class="ui-notice-title">抱歉，操作失败</h3>
            <p class="ui-notice-explain">错误原因，需技术提供。</p>
            <p class="ui-notice-explain-other">
                现在您可能需要：<a href="#">111</a>
                <span class="fn-bar">|</span>
                <a href="#">222</a>
                <span class="fn-bar">|</span>
                <a href="#">333</a>
            </p>
        </div>
    </div>
    <div class="section">
        <!-- begin ui-paging -->
        <div class="ui-paging fn-clear fn-hide">
<!--
            <input type="hidden" id="J_totalItmes" value="132" />
            <input type="hidden" id="J_pagingCurrent" value="10">
-->
        </div>
        <!-- end ui-paging -->
    </div>

<!--
    <div class="section">
        <div class="ui-paging fn-clear">
            <a class="ui-paging-prev" href="#">上一页</a>
            <a class="ui-paging-item" href="#"><span>1</span></a>
            <a class="ui-paging-item ui-paging-current" href="#"><span>2</span></a>
            <a class="ui-paging-item" href="#"><span>3</span></a>
            <a class="ui-paging-item" href="#"><span>4</span></a>
            <a class="ui-paging-item" href="#"><span>5</span></a>
            <a class="ui-paging-item" href="#"><span>6</span></a>
            <a class="ui-paging-item" href="#"><span>7</span></a>
            <span class="ui-paging-ellipsis">...</span>
            <a class="ui-paging-item" href="#"><span>1024</span></a>
            <a class="ui-paging-next" href="#">下一页</a>
            <span class="ui-paging-info fn-ml0"><span class="ui-paging-bold">2/1024</span>页</span>
            <span class="ui-paging-info ui-paging-which">
                <input id="J_pageNumber" type="text" value="" name="some_name">
            </span>
            <a href="#" class="ui-paging-info ui-paging-goto"><span>跳转</span></a>
        </div>
    </div>

    <div class="section">

        <div class="ui-paging fn-clear">
            <a class="ui-paging-prev" href="#">上一页</a>
            <span class="ui-paging-info">第<span class="ui-paging-bold">5/7</span>页</span>
            <a class="ui-paging-next" href="#">下一页</a>
        </div>

    </div>

    <div class="section">
        <div class="ui-paging ui-paging-text fn-clear">
            <a class="ui-paging-first" href="#">首页</a>
            <a class="ui-paging-prev" href="#">上一页</a>
            <span class="ui-paging-info">21 - 40条，共60条</span>
            <a class="ui-paging-next" href="#">上一页</a>
            <a class="ui-paging-last" href="#">尾页</a>
        </div>
    </div>

    -->

    <br/><br/><br/><br/>
    /****************分割器*****************/
    <br/><br/>
    请选择
    <select id="tplname" onchange="act()">
        <option value="0">分页模版1</option>
        <option value="1">分页模版2</option>
        <option value="2">分页模版3</option>
    </select>
    改变 总记录数 和 当前页 点击 分页看 分页效果：<br/>
    总记录数<input type="text" id="J_totalItmes" value="132" />
    当前页<input type="text" id="J_pagingCurrent" value="10" />
    <!--<input id="confirm" type="button" value="分页" onclick="act()"/>-->
    提交的数据为：<span id="result"></span>
    <br/>
    <textarea id="mockdata" style="width: 600px;height: 300px;">
        {rows : [
            {
                spliter : false,
                items : [{content :'12345'},{content :'name1'},{content :'into....1'},{content :'description1'}]
            },{
                spliter : true,
                items : [{content :'22345'},{content :'name2'},{content :'into....2'},{content :'description2'}]
            },{
                spliter : false,
                items : [{content :'32345'},{content :'name3'},{content :'into....3'},{content :'description3'}]
            },{
                spliter : true,
                items : [{content :'42345'},{content :'name4'},{content :'into....4'},{content :'description4'}]
            }
        ]}
    </textarea>


</form>

<script type="text/javascript" src="jquery-1.7.2.js"></script>

<script type="text/javascript" src="lib/base/cellula.js"></script>
<script type="text/javascript" src="lib/base/class.js"></script>
<script type="text/javascript" src="lib/base/util.js"></script>
<script type="text/javascript" src="lib/base/block.js"></script>
<script type="text/javascript" src="lib/base/element.js"></script>

<script type="text/javascript" src="lib/searchingScene/form.js"></script>
<script type="text/javascript" src="lib/searchingScene/paginator.js"></script>
<script type="text/javascript" src="lib/searchingScene/table.js"></script>

<script type="text/javascript" src="lib/searchingSceneAlipay/form-alipay.js"></script>
<script type="text/javascript" src="lib/searchingSceneAlipay/table-alipay.js"></script>
<script type="text/javascript" src="lib/searchingSceneAlipay/paginator-alipay.js"></script>
<script type="text/javascript" src="lib/searchingSceneAlipay/assets-alipay.js"></script>
<!--
<script type="text/javascript" src="../lib/dev/Class.js"></script>
<script type="text/javascript" src="lib/util.js"></script>
<script type="text/javascript" src="lib/searchModule.js"></script>
<script type="text/javascript" src="lib/form.js"></script>
<script type="text/javascript" src="lib/paginator.js"></script>
<script type="text/javascript" src="lib/element.js"></script>
<script type="text/javascript" src="lib/table.js"></script>
<script type="text/javascript" src="lib/searchingSceneAlipay.js"></script>
-->

<script type="text/javascript">
    window.console = window.console || function(){};
    var regCal = /^\d{4}-((0[1-9]{1})|(1[0-2]{1}))-((0[1-9]{1})|([1-2]{1}[0-9]{1})|(3[0-1]{1}))$/;
    //+'<td>$-{sn}</td>'
    //+'<td>$-{name}</td>'
    //+'<td>$-{intro}</td>'
    //+'<td>$-{desc}</td>'


/************************************************/
    var elementsArray = Cellula.Element.factory([{
        key : 'calendar',
        value : "{beginDate : $('#J_beginDate').val(), endDate : $('#J_endDate').val()}",
        //errHandler : function(msg){},
        validate : function(){
            $('.ui-form-explain').eq(0).html('').addClass('fn-hide');

            var b = this.data.value.beginDate, e = this.data.value.endDate;
            if(!(regCal.test(b) && regCal.test(e))){
                return '日期格式错误！';
            }
            if(b > e){
                return '开始日期不能大于结束日期';
            }
        }
    }, {
        key : '#J_siteNo',
        value : "{siteNo : $(this.key).val()}",
        errHandler : function(msg){
            $('.ui-form-explain').eq(0).html(msg).removeClass('fn-hide');
        },
        validate : function(){
            if(this.data.value.siteNo.length > 5 ){
                return '长度不能大于5！';
            }
        }
    },{
        key : '#J_batchNo',
        value : "{batchNo : $(this.key).val()}"
    }]);

    var pageElements = Cellula.Element.factory([{
        key : 'page',
        value : "{current : $('#J_pagingCurrent').val(), totalItems : $('#J_totalItmes').val()}"
        //value : "{current : 1, totalPages : 8}"
    },{
        key : 'size'
    }, {
        key : 'number',
        value : "{number : $('#J_pageNumber').val()}",
        //errHandler : function(msg){},
        validate : function(){
            var v = this.data.value.number;
            if(v && isNaN(Number(v))){
                return 'must be a number!';
            }
            if(v === ''){
                return 'could not be empty!';
            }
        }
    }]);

    //console.log(elementsArray);
    //console.log(pageElements);

    var f = new SearchingFormAlipay({
        collection : elementsArray,
        registerEvents : function(){
            $('.ui-button-mblue').bind('click', this.doSearch);
        },
        search : function(data){
            //console.log('custom! post? submit? as your wish!');

            var str = '';
            for(var nn in data){
                str += nn + '=' + data[nn]+'; '
            }
            $('#result').html(str);


            // simulating ajax callback
            if(data.number) $('#J_pagingCurrent').val(data['number']);
            if(data.totalItems) $('#J_totalItmes').val(data['totalItems']);


            //var tabledata = eval($('#mockdata').val());
            var tabledata = new Function("return " + $('#mockdata').val() ).call(this);

            //if(!Cellula._util.isArray(tabledata)) alert('table data struct error!');
            if(!Cellula._util.isObject(tabledata)) alert('table data struct error!');

            var d = {
                paging : {
                    page:{
                        current:$('#J_pagingCurrent').val(),
                        totalItems:$('#J_totalItmes').val()
                    }
                },
                dataTable : tabledata
                //dataTable : {
                //    rows : tabledata
                //}
            };


            this.dataDispatch(d);
        }
    });

    var pg = new PaginatorAlipay({
        collection : pageElements,
        pageTpl : searchingSceneAssets.pagingTplStyles[0],
        pageDefault : {
            number : {number : 1},
            size : {size : 10}
        },
        registerEvents : function(){
            //$('#J_sizePerPage').bind('change', this.changeSize);
            //$('.ui-paging-goto').bind('click', this.paginate);
            $('.ui-paging-first,.ui-paging-last,.ui-paging-prev,.ui-paging-next,.ui-paging-item,.ui-paging-goto').bind('click', this.paginate);

        }
    });


    // for ajax
    var dt = new DataTableAlipay({
        tableTpl : searchingSceneAssets.tableTplStyles[0]
    });

    !function(){
        f.registerInterface('getDefault', pg);
        f.registerInterface('getData', pg);
        f.registerInterface('render', pg);
        f.registerInterface('render', dt);
        f.registerInterface('error', pg);
        f.registerInterface('error', dt);
        dt.registerInterface('error', pg);
        //console.log(dt);

        pg.registerInterface('doSearch', f);
        //console.log(pg.pageDefault);

    }();
/**************************************/
    var act = function (){
        pg.pageTpl = searchingSceneAssets.pagingTplStyles[$('#tplname').val()];
        $('#tplname').val() === '2'?$('.ui-paging').addClass('ui-paging-text'):$('.ui-paging').removeClass('ui-paging-text');
        f.search({});
        //pg.save('page');
        //pg.render();
    };
</script>
</body>
</html>